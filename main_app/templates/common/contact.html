{% load static %}
{% include 'common/head.html' %}
{% include 'common/navbar.html' %}

<section class="flex justify-center items-center min-h-screen bg-gray-50">
  <div class="bg-white shadow-lg rounded-2xl p-8 max-w-lg w-full text-center">
    <h2 class="text-3xl font-bold text-indigo-600 mb-3">Contact Us</h2>
    <p class="text-gray-600 mb-6">Weâ€™d love to hear from you! Please fill out the form below.</p>

    <form id="contactForm" method="POST" action="{% url 'contact_submit' %}" class="text-left">
      {% csrf_token %}
      <div class="mb-4">
        <label for="name" class="block text-sm font-semibold text-gray-700 mb-1">Full Name</label>
        <input type="text" id="name" name="name" required
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-300 focus:outline-none" />
      </div>

      <div class="mb-4">
        <label for="email" class="block text-sm font-semibold text-gray-700 mb-1">Email Address</label>
        <input type="email" id="email" name="email" required
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-300 focus:outline-none" />
      </div>

      <div class="mb-4">
        <label for="message" class="block text-sm font-semibold text-gray-700 mb-1">Your Message</label>
        <textarea id="message" name="message" rows="4" required
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-300 focus:outline-none"></textarea>
      </div>

      <button id="sendBtn" type="submit"
        class="w-full py-2 mt-2 bg-indigo-600 text-white font-semibold rounded-lg hover:bg-indigo-700 transition">
        Send Message
      </button>
    </form>
  </div>
</section>

<!-- Success Modal (hidden initially) -->
<div id="successModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center hidden z-50">
  <div class="bg-white p-8 rounded-xl shadow-lg w-[420px] text-center">
    <div class="flex justify-center mb-4">
      <div class="w-14 h-14 bg-green-100 rounded-full flex items-center justify-center">
        <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="#22c55e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <path d="M20 6L9 17l-5-5" />
        </svg>
      </div>
    </div>
    <h2 class="text-xl font-semibold text-gray-800 mb-2">Request Submitted!</h2>
    <p id="successMsg" class="text-gray-600 mb-6">Your request has been successfully submitted. We'll get back soon.</p>
    <button id="closeSuccess" class="bg-indigo-600 hover:bg-indigo-700 text-white px-6 py-2 rounded-lg">OK</button>
  </div>
</div>

{% include 'common/footer.html' %}

<script>
  // Helper to get csrftoken from cookie
  function getCookie(name) {
    const v = document.cookie.match('(^|;)\\s*' + name + '\\s*=\\s*([^;]+)');
    return v ? v.pop() : '';
  }

  document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('contactForm');
    const modal = document.getElementById('successModal');
    const successMsg = document.getElementById('successMsg');
    const closeSuccess = document.getElementById('closeSuccess');

    form.addEventListener('submit', async (e) => {
      // if JS is available, send via fetch and prevent default full-page submit
      e.preventDefault();

      const formData = new FormData(form);
      const csrftoken = getCookie('csrftoken');

      try {
        const res = await fetch(form.action, {
          method: 'POST',
          headers: {
            'X-CSRFToken': csrftoken,
            'X-Requested-With': 'XMLHttpRequest'
          },
          body: formData
        });

        const data = await res.json();

        if (data && data.isOK) {
          // show modal with success message
          successMsg.innerText = data.msg || 'Submitted successfully.';
          modal.classList.remove('hidden');
          // optionally reset form
          form.reset();
        } else {
          // show simple alert on failure
          alert((data && data.msg) ? data.msg : 'Failed to submit. Please try again.');
        }
      } catch (err) {
        console.error(err);
        alert('Network or server error. Please try again.');
      }
    });

    // close modal handler
    closeSuccess.addEventListener('click', () => {
      modal.classList.add('hidden');
    });

    // allow clicking background to close
    modal.addEventListener('click', (ev) => {
      if (ev.target === modal) modal.classList.add('hidden');
    });
  });
</script>
